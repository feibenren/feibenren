<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>站内搜索</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.js"></script> -->
    <script src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
</head>

<body>
    <div class="container" id="app">
        <br>
        <div class="row">
            <div class="col-md-12">
                <form @submit.prevent='search' class="form-inline">
                    <div class="form-group">
                        <input v-model='keyword' type="text" class="form-control">
                        <input type="submit" class="btn btn-primary" value="搜索">
                    </div>
                </form>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-12">
                <ul class="list-group" v-if='list.length !==0'>
                    <li class="list-group-item" v-for='val in list'>
                        <a :href="val.url" v-html='val.title'></a>
                        <div v-html='val.content'>

                        </div>
                    </li>
                </ul>
                <p class="text-center" v-if='list.length ===0'>
                    搜索结果为空
                </p>
            </div>
        </div>
    </div>

</body>
<style>
    .match {
        background-color: #ff0;
    }
</style>

</html>
<script>
    var app = new Vue({
        el: '#app',
        data: function () {
            return {
                keyword: '',
                raw_list: [],
                list: [],
            }
        },
        mounted() {
            this.keyword = location.search.substr(1).split('&')[0].split('=')[1];
            this.search();
        },
        
        methods: {
            search() {
                if (!this.keyword) {
                    return;
                }
                this.list = [];
                // axios.get('http://feibenren.gitee.io/search.json')
                axios.get('http://127.0.0.1:5500/search.json')
                    .then((response) => {
                        this.raw_list=response.data;
                        let p = new RegExp(this.keyword, 'g');
                        this.raw_list.map(val => {
                            if (p.test(val.title)) {
                                this.list.push(val);
                            }
                        });

                        this.raw_list.map(val => {
                            if (p.test(val.content)) {
                                //跟换html实体
                                val.title = val.title.replace(p, `<span class='match'>${this.keyword}</span>`);
                                val.content = val.content.replace(/</g, `$lt;`);
                                val.content = val.content.replace(/>/g, `$gt;`);
                                val.content = val.content.replace(p, `<span class='match'>${this.keyword}</span>`);
                                this.list.push(val);
                            }
                        });

                    })
            }
        }
    })
</script>
---
title: 事件循环
categories: 
- ECMASCRIPT
---

# 单线程

js是单线程的，这样设计的原因就是因为最初的执行环境是浏览器，需要应对各种DOM操作，同时又需要保持简单，所以设计成单线程的

但是单线程`没有并行处理任务的能力`

所以js在设计的时候，使用了`event loop`机制

# 事件循环

维基百科定义:

> Event Loop是一个程序结构，用于等待和发送消息和事件。（a programming construct that waits for and dispatches events or messages in a program.）


简单说，就是在程序中设置两个线程：

一个负责程序本身的运行，称为"主线程"；

另一个负责主线程与其他进程的通信，被称为"Event Loop线程"，也就是事件处理进程。

### 运行流程

- 程序开始执行，代码压入栈中
- 当Stack中执行到异步任务的时候，就将他丢给WebAPIs,接着执行同步任务,直到Stack为空;
- 在此期间WebAPIs完成这个事件，把回调函数放入CallbackQueue中等待;
- 当执行栈为空时，Event Loop把Callback Queue中的一个任务放入Stack中,回到第1步。

### 具体实现

- Event Loop是由javascript宿主环境（像浏览器）来实现的;
- WebAPIs是由C++实现的浏览器创建的线程，处理诸如DOM事件、http请求、定时器等异步事件;
- ECMASCRIPT 的并发模型基于"事件循环";
- Callback Queue(Event Queue 或者 Message Queue) 任务队列,存放异步任务的回调函数

# 宏任务和微任务

任务队列分为宏任务队列(macro queue task list)和微任务队列(micro queue task list)

macro:
- dom事件
- setTimeout()/setInterval()
micro
- promise()
- MutaionObserver()

js引擎，`总是先执行mircro,再执行macro`




# links
- [https://juejin.im/post/5afbc62151882542af04112d](https://juejin.im/post/5afbc62151882542af04112d)
- [https://zhuanlan.zhihu.com/p/33058983](https://zhuanlan.zhihu.com/p/33058983)
- [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop)






# links

- [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop)